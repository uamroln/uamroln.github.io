<!DOCTYPE html>
<html>
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-179401054-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-179401054-1');
</script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Matt Rolniak">
<meta name="description" content="Sums up to 18">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<script src="https://kit.fontawesome.com/eff118460a.js" crossorigin="anonymous"></script>
<style>
body, html{
	height:100%;
	margin:0;
}
.background{
	height:100%;
}
</style>

</head>
<title>
Nonsequitus Learning - Fast Math!
</title>
<audio id="loadSound">
	<source src="Assets/Alley Dream.mp3" type="audio/mp3">
</audio>
<audio id="rightSound">
	<source src="Assets/smb_coin.wav" type="audio/wav">
</audio>
<audio id="wrongSound">
	<source src="Assets/smb_pipe.wav" type="audio/wav">
</audio>
</head>

<body>
<!-- Main Header -->
<div class="w3-container w3-blue-gray w3-wide" id="header">
<h1>Nonsequitus Learning</h1>
</div><!-- End Main header -->

<!-- page outer background -->
<div class="w3-container w3-blue background">

<!-- Nav -->
<div class="w3-bar w3-light-blue w3-border w3-round-xlarge"  id="nav">

<a href="index.html" class="w3-bar-item w3-button"><i class="fas fa-home"></i> Home</a>
<a href="Math Flash Cards v1.3.html" class="w3-bar-item w3-button"><i class="fas fa-plus"></i> Math Addition Flash Cards</a>
<a href="Sight Words v1.0.html" class="w3-bar-item w3-button"><i class="fas fa-book-reader"></i> Sight Words Flash Cards</a>

</div><!-- End nav -->

<!-- page inner background -->
<div class="w3-container w3-pale-blue background">

<!-- onload modal -->
	<div class="w3-modal" id="directions">
		<div class="w3-modal-content w3-light-grey w3-container">
			<span onclick="toggleModal('directions')" class="w3-button w3-display-topright"><i class="fas fa-times"></i></span>
			<p>Answer the math problems as fast as you can.</p>
			<p></p>
		</div>
	</div> 

<!-- header -->
<div class="w3-bar w3-panel w3-deep-purple w3-animate-top">
<h2><span class="w3-bar-item w3-wide">Math Flash Cards</span>
	<div class="w3-bar-item w3-right">
		<button class="w3-deep-purple w3-button w3-large" id="options" onclick="toggleModal('optionPane')" >Options</button>
		<!-- modal options screen -->
		<div class="w3-modal" id="optionPane" style="display:none">
			<div class="w3-modal-content w3-light-grey w3-container">
				<span class="w3-section">Options</span><span onclick="toggleModal('optionPane')" class="w3-button w3-display-topright"><i class="fas fa-times"></i></span>
				<p class="w3-section">Speed:<input type="range" id="speed" min="0" max="20" value="6" onchange="updateSpeed()"> 
					<span class="w3-large w3-tooltip"><i class="fas fa-question-circle"></i> 
						<em class="w3-text w3-animate-right">Adjusts the amount of time between answering one question and loading the next question.</em>
					</span>
				</p>
				<p class="w3-section">Add up to <span id="sumCapDisp">Max</span><input type="range" id="sumCap" min="2" max="10" value="10" onchange="updateSumCap()">
					<span class="w3-large  w3-tooltip"><i class="fas fa-question-circle"></i> 
						<em class="w3-text w3-animate-right">Adjusts how large the second addend can be (from 2 to 9).</em>
					</span>
				</p>
				<p class="w3-section">Digits: <span id="digitsDisp">2</span><input type="range" id="addendDigits" min="1" max ="2" value="2" onchange="updateDigits()">
					<span class="w3-large w3-tooltip"><i class="fas fa-question-circle"></i> 
						<em class="w3-text w3-animate-right">Adjusts whether the first addend can be 1 digit or 2 digits.</em>
					</span>
				</p>
				<button id="resetGame" onclick="resetGame()">Reset Game</button> 
			</div>
		</div> <!-- end modal options screen --> 
		<button class="w3-deep-purple w3-button" id="volume" onclick="muter()"><i class="fas fa-volume-mute"></i></button>
	</div>
</h2>
</div>

<!-- Timer / Score Keeper -->
<div class="w3-teal w3-animate-top w3-medium w3-bar">
  <div class="w3-bar-item w3-left" id="timeClock"> 10:00 </div>
  <div class="w3-bar-item w3-right" id="hitRate">Correct: 0 / 0 </div> 
</div>

<!-- Problem -->
<div class="w3-panel">
<div class="w3-panel w3-card w3-purple w3-center w3-middle w3-xxxlarge w3-animate-left" id="problem">
X + Y = 
</div>

<!-- Answer Panel -->
<div class="w3-display-containter">
	<div class="w3-center w3-panel w3-light-grey w3-animate-right w3-hover-shadow">	
		<button class="w3-button w3-xlarge answer" onclick="answer(1)">1</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(2)">2</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(3)">3</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(4)">4</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(5)">5</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(6)">6</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(7)">7</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(8)">8</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(9)">9</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(10)">10</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(11)">11</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(12)">12</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(13)">13</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(14)">14</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(15)">15</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(16)">16</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(17)">17</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(18)">18</button>
		<button class="w3-button w3-xlarge answer" onclick="answer(0)">0</button>
		<button class="w3-button w3-xlarge answer" onclick="answer('skip')">skip</button>
	</div>
</div> <!-- end Answer Panel -->
</div> <!-- end Problem area -->

<!-- Problem Timer -->
<div class="w3-center">
<div class="w3-round-xlarge w3-indigo w3-bar w3-tiny" id="probTimerBar">
	<i class="w3-bar-item w3-text-yellow fas fa-circle"></i>
	<i class="w3-bar-item w3-text-yellow fas fa-circle"></i>
	<i class="w3-bar-item w3-text-yellow fas fa-circle"></i>
	<i class="w3-bar-item w3-text-yellow fas fa-circle"></i>
	<i class="w3-bar-item w3-text-yellow fas fa-circle"></i>
	<i class="w3-bar-item w3-text-yellow fas fa-circle"></i>
	<i class="w3-bar-item w3-text-yellow fas fa-circle"></i>
	<i class="w3-bar-item w3-text-yellow fas fa-circle"></i>
	<i class="w3-bar-item w3-text-yellow fas fa-circle"></i>
	<i class="w3-bar-item w3-text-yellow fas fa-circle"></i>
</div>
</div>
<!-- History -->
<div>
	<button class="w3-button w3-teal w3-large" onclick="toggleHist()" id="histT">Show history <i class="fa fa-chevron-down"></i></button>
</div>

<div class="w3-light-grey w3-topleft w3-animate-bottom w3-card w3-panel" style="display:none" id="hist">
	<div class="w3-bar-item">Problem History</div>
</div>
<!-- end History -->

</div> <!-- end inner background -->
</div> <!-- end outer background -->
</body>

<!-- footer -->
<div class="w3-container w3-blue">
<footer class="w3-bar w3-light-blue w3-border w3-round-xlarge">
	<a class="w3-bar-item w3-button" href="index.html"><i class="fa fas-home"></i> Home</a>
</footer>
</div>

<script>
var sum, addend1, addend2, expression, doOver, sumBy;
updateSumCap();
var digitCount = parseInt(document.getElementById("addendDigits").value);
var count = 0;
var correct = 0;
var rflag = false;
var mute = true;
var refreshSpeed = 1400; // 1.4 second, the delay between answering a question and displaying the next question.
var timeLimit = 600000; // 10 minutes, the amount of time the game will accept responses. Don't overdo it kids!
//var timeLimit = 15000; // 15 seconds
var probSecondTimer = 10; // variable which tracks the number of seconds remaining in the problem timer
var probSecondTimerOn = true;
var newProbTimer; // variable which contains the timeOut function for refreshSpeed
var timer; // variable which contains the interval function for timeLimit
var flagTimeUp = false;
var flashTime;
var changeFlag = true;
var showHistFlag = false;

var introSound = document.getElementById("loadSound");
//introSound.volume = 0.25;
//introSound.autoplay = true;
introSound.loop = true;
introSound.load();

document.getElementById("directions").style.display = "block";

function newProblem(){
	if(digitCount == 2){
		addend2 = Math.floor(Math.random() * sumBy);
		addend1 = Math.floor(Math.random() * (18-addend2));
	}
	if(digitCount == 1){
		if(sumBy == "19"){addend2 = Math.floor(Math.random() * 10);}
		else{addend2 = Math.floor(Math.random() * sumBy);}
		addend1 = Math.floor(Math.random() * 10);
	}

	sum = addend1 + addend2;
	console.log("addend2:"+addend2+" sum:"+sum);
	document.getElementById("problem").innerHTML = addend1 + " + " + addend2 + " = ";
	expression = addend1 + " + " + addend2 + " = ";
	enableAnswerPanel();
	enableRetry();
	probSecondTimer=10;
	updateProbSecondTimer();
	probSecondTimerOn = true;
}

function addToHist(problem){
	disableAnswerPanel();
	disableRetry();
	probSecondTimerOn = false;
	var element = document.getElementById("hist");
	element.appendChild(problem);
	if(!flagTimeUp) newProbTimer = setTimeout(newProblem,refreshSpeed);
}

function skip(){
	answer('skip');
}

function answer(resp){
	disableRetry();
	if(!flagTimeUp){
		var histButton = document.createElement("button");
		histButton.setAttribute("class","w3-round w3-border-green w3-animate-zoom w3-large");
		histButton.id = "PR" + count + "," + addend1 + "," + addend2 + "," + resp;
		histButton.innerHTML = expression + resp;
		//console.log("sum: "+sum+" add1: "+addend1+" add2 "+addend2);
		if(!rflag)count++;
		if (sum==resp){
			correct++;
			document.getElementById("problem").innerHTML += resp + ' <i class="fas fa-check w3-green"></i>';
			if(!mute)document.getElementById("rightSound").play();
		}
		else if(resp=="skip"){
			histButton.setAttribute("class","w3-round w3-yellow w3-border-yellow w3-animate-zoom w3-large w3-hover-shadow");
			histButton.setAttribute("onclick","retry('"+histButton.id+"')");
			document.getElementById("problem").innerHTML += " <span class='w3-yellow'>skip</span>";
		}
		else{
			histButton.setAttribute("class","w3-round w3-red w3-border-red w3-animate-zoom w3-large w3-hover-shadow");
			histButton.setAttribute("onclick","retry('"+histButton.id+"')");
			document.getElementById("problem").innerHTML += resp + ' <span class="w3-red"><i class="fas fa-times"></i></span>';
			if(!mute)document.getElementById("wrongSound").play();
		}
		document.getElementById("hitRate").innerHTML = "Correct: " + correct + " / " + count;
		addToHist(histButton);
		rflag = false;
	}
}

function retry(problemID){
	disableRetry();
	if(!flagTimeUp){
		var expr = problemID.split(",");
		addend1 = parseInt(expr[1]);
		addend2 = parseInt(expr[2]);
		sum = addend1 + addend2;
		document.getElementById("problem").innerHTML = addend1 + " + " + addend2 + " = ";
		expression = addend1 + " + " + addend2 + " = ";
		var elmt = document.getElementById(problemID);
		elmt.remove();
		rflag = true;
		probSecondTimer=10;
		updateProbSecondTimer();
	}
}
function toggleHist()
{
	if(!showHistFlag){
		document.getElementById("histT").innerHTML = 'Hide history <i class="fas fa-chevron-up"></i>';
		document.getElementById("hist").style.display = "block";
		showHistFlag = true;
	}
	else{
		document.getElementById("histT").innerHTML = 'Show history <i class="fas fa-chevron-down"></i>';
		document.getElementById("hist").style.display = "none";
		showHistFlag = false;
	}
}
function toggleModal(pane){
	var thisPane = document.getElementById(pane);
	if(pane=="directions"){
		thisPane.style.display = "none";
		document.getElementById('optionPane').style.display = 'block';
	}
	if(pane=="optionPane"){
		if(thisPane.style.display == "none"){
			thisPane.style.display = "block";
			pauseCountDown();
		}
		else{
			thisPane.style.display = "none";
			startCountDown();
			if(changeFlag){
				changeFlag = false;
				newProblem();
			}
		}
	}
}

function updateSpeed(){
	refreshSpeed = (20 - document.getElementById("speed").value) * 100;
}
function updateSumCap(){
	var disp = document.getElementById("sumCap").value;
		if(disp == 10){
		disp = "Max";
		sumBy = 19;
	}
	else{
		disp = "+" + disp;
		sumBy = parseInt(disp);
	}
	changeFlag = true;
	document.getElementById("sumCapDisp").innerHTML = disp;
}
function updateDigits(){
	digitCount = parseInt(document.getElementById("addendDigits").value);
	document.getElementById("digitsDisp").innerHTML = digitCount;
	changeFlag = true;
}
// the following functions are used to prevent input while animations/transitions are occuring
function disableAnswerPanel(){
	answerPanel = document.getElementsByClassName("w3-button w3-xlarge answer");
	var i;
	for(i=0;i<answerPanel.length;i++){
		answerPanel[i].setAttribute("disabled","");
	}
}
function enableAnswerPanel(){
	answerPanel = document.getElementsByClassName("w3-button w3-xlarge answer");
	var i;
	for(i=0;i<answerPanel.length;i++){
		answerPanel[i].removeAttribute("disabled");
	}
}
function disableRetry(){
	var probs = document.getElementsByClassName("w3-round w3-red w3-border-red w3-animate-zoom w3-large w3-hover-shadow");
	var i;
	for(i=0; i<probs.length; i++){
		probs[i].setAttribute("disabled","");		
	}
	probs = document.getElementsByClassName("w3-round w3-yellow w3-border-yellow w3-animate-zoom w3-large w3-hover-shadow");
	for(i=0; i<probs.length; i++){
		probs[i].setAttribute("disabled","");		
	}
}
function enableRetry(){
	var probs = document.getElementsByClassName("w3-round w3-red w3-border-red w3-animate-zoom w3-large w3-hover-shadow");
	var i;
	for(i=0; i<probs.length; i++){
		probs[i].removeAttribute("disabled");		
	}
	probs = document.getElementsByClassName("w3-round w3-yellow w3-border-yellow w3-animate-zoom w3-large w3-hover-shadow")
	for(i=0; i<probs.length; i++){
		probs[i].removeAttribute("disabled");		
	}
}
// togle sound
function muter(){
	if(mute){
		mute = false;
		document.getElementById("volume").innerHTML = '<i class="fas fa-volume-up"></i>';
		introSound.play();
		introSound.volume = .05;
		return(0);
	}
	else{
		mute = true;
		document.getElementById("volume").innerHTML = '<i class="fas fa-volume-mute"></i>';
		introSound.pause();
		return(0);
	}
}

function resetGame(){
	clearInterval(timer);
	document.getElementById("hist").innerHTML='<div class="w3-bar-item">Problem History</div>';
	resetCountDown();
	count = 0;
	correct = 0;
	probSecondTimer = 10;
	updateProbSecondTimer();
	document.getElementById("hitRate").innerHTML = "Correct: " + correct + " / " + count;
	changeFlag = true;
}

 //keep time
// Set the date we're counting down to

function pauseCountDown(){
	clearInterval(timer);
}
function resetCountDown(){
	timeLimit = 600000;
	clearInterval(flashTime);
	document.getElementById("timeClock").classList.remove("w3-text-red","w3-hide");
	updateClock(timeLimit);
}
function startCountDown(){
	// Update the count down every 1 second
	timer = setInterval(function() {
	updateClock(timeLimit);
	  // If the count down is finished, write some text
	  if (timeLimit <= 0) {
		clearInterval(timer);
		document.getElementById("timeClock").innerHTML = "00:00";
		document.getElementById("timeClock").classList.add("w3-text-red");
		flashTime();
		flagTimeUp = true;
		
	  }
    timeLimit -= 1000;
}, 1000); 
}

function updateClock(time){
	// Time calculations for days, hours, minutes and seconds
	  var minutes = Math.floor((time % (1000 * 60 * 60)) / (1000 * 60));
	  var seconds = Math.floor((time % (1000 * 60)) / 1000);
	  var m = minutes.toString();
	  var s = seconds.toString();
	  if(minutes<10) m = "0"+minutes.toString();
	  if(seconds<10) s = "0"+seconds.toString();

	  // Display the result in the element with id="timeClock"
	  document.getElementById("timeClock").innerHTML = m + ":" + s;
	  if(probSecondTimer>=0 && probSecondTimerOn)probSecondTimer--;
	  if(probSecondTimer == 0 && !flagTimeUp && probSecondTimerOn) skip();
	  updateProbSecondTimer();	  
}
function updateProbSecondTimer(){
	  var e = "";
	  for(i=0;i<probSecondTimer;i++){
		e += "<i class='w3-bar-item w3-text-yellow fas fa-circle'></i>";
	  }
	  for(i=0;i<(10-probSecondTimer);i++){
		e += "<i class='w3-bar-item w3-text-yellow far fa-circle'></i>";
	  }
	  document.getElementById("probTimerBar").innerHTML = e;
}
function flashTime(){
	flashTime = setInterval(function(){
		document.getElementById("timeClock").classList.toggle("w3-hide");
	},1000);	
}
</script>
</html>